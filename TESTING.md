# Тестирование

В проекте настроено тестирование с использованием [Vitest](https://vitest.dev/) - современного тестового фреймворка для Vite.

## Установка зависимостей

```bash
pnpm install
```

## Запуск тестов

### Запуск всех тестов
```bash
pnpm test:run
```

### Запуск тестов в режиме watch
```bash
pnpm test
```

### Запуск тестов с UI интерфейсом
```bash
pnpm test:ui
```

### Запуск тестов с покрытием
```bash
pnpm test:coverage
```

## Структура тестов

```
src/
├── test/
│   ├── setup.ts              # Глобальные настройки для тестов
│   └── utils/
│       ├── auth.test.ts      # Тесты для утилит аутентификации
│       └── recipe-utils.test.ts # Тесты для утилит работы с рецептами
└── utils/
    └── recipe-utils.ts       # Утилиты для работы с рецептами
```

## Написанные тесты

### 1. Тесты аутентификации (`auth.test.ts`)

Тестируют функции работы с JWT токенами:

- `createJWT` - создание JWT токенов
- `verifyJWT` - проверка JWT токенов

**Покрываемые сценарии:**
- Создание валидного JWT токена
- Проверка правильности данных в токене
- Проверка времени истечения токена
- Валидация правильных токенов
- Обработка невалидных токенов
- Обработка токенов с неправильной подписью
- Обработка пустых строк

### 2. Тесты утилит рецептов (`recipe-utils.test.ts`)

Тестируют функции для работы с рецептами:

- `findRecipeById` - поиск рецепта по ID
- `findRecipesByName` - поиск рецептов по названию
- `calculateTotalCalories` - вычисление общей калорийности
- `findRecipesByCalorieRange` - поиск рецептов по диапазону калорий
- `getAllIngredients` - получение списка всех ингредиентов

**Покрываемые сценарии:**
- Поиск существующих и несуществующих рецептов
- Поиск по точному и частичному названию
- Нечувствительность к регистру
- Вычисление калорий для одного и нескольких рецептов
- Фильтрация по диапазону калорий
- Получение уникальных и отсортированных ингредиентов

## Написание новых тестов

### Создание нового теста

1. Создайте файл с расширением `.test.ts` в папке `src/test/`
2. Импортируйте необходимые функции из Vitest и тестируемые модули
3. Используйте `describe` для группировки тестов
4. Используйте `it` для описания отдельных тестов
5. Используйте `expect` для проверок

### Пример структуры теста

```typescript
import { describe, it, expect, beforeEach } from 'vitest'
import { myFunction } from '../path/to/module.js'

describe('My Module', () => {
  beforeEach(() => {
    // Настройка перед каждым тестом
  })

  it('должен выполнить ожидаемое действие', () => {
    const result = myFunction('input')
    expect(result).toBe('expected output')
  })
})
```

### Лучшие практики

1. **Описательные названия тестов** - используйте русский язык для описания
2. **Группировка тестов** - используйте `describe` для логической группировки
3. **Изоляция тестов** - каждый тест должен быть независимым
4. **Покрытие граничных случаев** - тестируйте не только happy path
5. **Mocking** - используйте моки для внешних зависимостей

## Конфигурация

Конфигурация тестов находится в файле `vitest.config.ts`:

- `environment: 'jsdom'` - для тестирования DOM API
- `globals: true` - глобальные импорты для тестовых функций
- `setupFiles` - файл с глобальными настройками

## Переменные окружения для тестов

В файле `src/test/setup.ts` устанавливаются переменные окружения для тестов:

- `JWT_SECRET` - секретный ключ для JWT
- `NODE_ENV` - окружение выполнения
